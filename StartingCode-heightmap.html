<html>
<head>
	<title>Starting Code for 1st Project 2017</title>
	<style>

	body {
		font-family: Monospace;
		background-color: #f0f0f0;
		margin: 0px;
		overflow: hidden;
	}

	canvas {
		width: 100%;
		height: 100%;
	}

	</style>
	<script src="lib/three.min.js"></script>
	<script src="lib/stats.min.js"></script>
	<script src="lib/Coordinates.js"></script>
	<script src="lib/OrbitControls.js"></script>
	<script src="classes/heightmap.js"></script>
	<script src="classes/maze.js"></script>
	<script src="classes/minotaur.js"></script>
	<script src="classes/character.js"></script>
	<script src="classes/solution.js"></script>

</head>
<body>

	<script>

	var scene, camera, renderer, controls, stats;
	var matrixSolution;
	var position


	function Start() {
		scene = new THREE.Scene();
		camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

		renderer = new THREE.WebGLRenderer( {antialias: true} );
		renderer.setSize( window.innerWidth, window.innerHeight );
		renderer.setClearColor( 0xf0f0f0 );
		document.body.appendChild( renderer.domElement );

		camera.position.set(0,30,30);
		camera.lookAt( new THREE.Vector3(0,0,0));

		stats = new Stats();
		stats.domElement.style.position = 'absolute';
		stats.domElement.style.top = '0px';
		document.body.appendChild( stats.domElement );

		hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6 );
		hemiLight.color.setHSL( 0.6, 1, 0.6 );
		hemiLight.groundColor.setHSL( 0.095, 1, 0.75 );
		hemiLight.position.set( 0, 500, 0 );
		scene.add( hemiLight );

		dirLight = new THREE.DirectionalLight( 0xffffff, 1 );
		dirLight.color.setHSL( 0.1, 1, 0.95 );
		dirLight.position.set( -1, 10, 1 );
		dirLight.position.multiplyScalar( 50 );
		scene.add( dirLight );
		dirLight.castShadow = true;
		dirLight.shadow.mapSize.width = 1024;
		dirLight.shadow.mapSize.height = 1024;

		addGround();
		// uncomment if you need to draw coordinate axes when building the scene
		//Coordinates.drawAllAxes();

		controls = new THREE.OrbitControls( camera );
		controls.addEventListener( 'change', Render );

		//labirinto e minotauro
		var m = new Maze("textures/circular/cLab_90.png",10); //percorso della texture e altezza
		var min = new Minotaur();
		var char = new Character();

		var maze = m.getMaze();
		var minotaur = min.getMinotaur();
		var character = char.getCharacter();

		scene.add(maze);

		maze.add(minotaur);
		maze.add(character);

		character.position.set(13,0,-6);
		character.rotation.y = Math.PI/2;

		minotaur.position.set(0,0,0);

		var image = new Image();

		image.src = 'textures/circular/cLab_sol_90.png';

		image.onload = function (){
			loadMatrixSolution(image);
		}

	}

	function loadMatrixSolution(image){
		var sol = new Solution(image);
		sol.createSolution();

		matrixSolution = sol.getSolution();
	}

	function Update() {
		requestAnimationFrame( Update );
		controls.update();
		stats.update();

		if(matrixSolution != undefined){

		}

		Render();
	}

	function Render() {
		renderer.render(scene, camera);
	}

	function addGround(){
		var groundGeo = new THREE.PlaneBufferGeometry(1000,1000 );
		var textureGround = new THREE.TextureLoader().load('textures/sand.jpg');
		textureGround.wrapS = THREE.RepeatWrapping;
		textureGround.wrapT = THREE.RepeatWrapping;
		textureGround.repeat.set(100,100);
		var groundMat = new THREE.MeshPhongMaterial({map: textureGround});
		var ground = new THREE.Mesh( groundGeo, groundMat );
		ground.rotation.x = -Math.PI/2;
		scene.add( ground );
		ground.receiveShadow = true;

	}



	Start();
	Update();

	</script>
</body>
</html>
